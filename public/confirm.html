<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Conferma appuntamento</title>
    <link rel="stylesheet" href="/assets/app.css" />
    <style>
      body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
      .c-wrap{ min-height:100vh; display:flex; align-items:center; justify-content:center; padding:18px; background: var(--bodyBg); color: var(--text); }
      .c-card{
        width: min(560px, 94vw);
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 18px;
      }
      .c-title{ font-weight: 900; font-size: 22px; margin: 0 0 10px; }
      .c-sub{ color: var(--muted); font-weight: 700; margin: 0 0 16px; line-height: 1.4; }
      .c-row{ display:flex; gap:12px; justify-content:flex-end; flex-wrap:wrap; }
      .btn{
        border: 1px solid var(--border);
        background: var(--btnBg);
        color: var(--text);
        border-radius: 12px;
        padding: 12px 16px;
        font-weight: 900;
        cursor: pointer;
      }
      .btn:hover{ background: var(--btnBgHover); }
      .btn-primary{
        border-color: color-mix(in srgb, var(--accent) 35%, transparent);
        background: color-mix(in srgb, var(--accent) 14%, transparent);
        color: var(--accent);
      }
      .ok{ color: var(--ok); font-weight: 900; }
      .err{ color: var(--warn); font-weight: 900; }
    </style>
  </head>
  <body class="fp-theme-standard">
    <div class="c-wrap">
      <div class="c-card">
        <h1 class="c-title">Conferma appuntamento</h1>
        <p class="c-sub" id="msg">Caricamento…</p>
        <div class="c-row">
          <button class="btn btn-primary" id="confirmBtn" disabled>Conferma</button>
        </div>
      </div>
    </div>
    <script>
      (function(){
        const qs = new URLSearchParams(location.search);
        const t = qs.get("t") || "";
        const msg = document.getElementById("msg");
        const btn = document.getElementById("confirmBtn");
        if (!t) {
          msg.textContent = "Link non valido.";
          msg.className = "c-sub err";
          return;
        }
        btn.disabled = false;
        msg.textContent = "Premi conferma per confermare l'appuntamento.";
        btn.onclick = async () => {
          btn.disabled = true;
          msg.textContent = "Confermo…";
          try {
            const res = await fetch("/api/patient-confirm?t=" + encodeURIComponent(t), { method: "POST" });
            const data = await res.json().catch(() => ({}));
            if (!res.ok || !data.ok) throw new Error(data.error || ("HTTP " + res.status));
            msg.textContent = "Confermato. Grazie!";
            msg.className = "c-sub ok";
          } catch (e) {
            msg.textContent = "Errore: link scaduto o non valido.";
            msg.className = "c-sub err";
            btn.disabled = false;
          }
        };
      })();
    </script>
  </body>
</html>

